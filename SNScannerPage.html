<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webcam Serial Number Scanner</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.1/dist/tesseract.min.js"></script>
    <style>
        #video {
            border: 2px solid #000;
            width: 640px;
            height: 480px;
        }
        #roi {
            position: absolute;
            border: 2px solid green;
            width: 50%;
            height: 20%;
            top: 40%;
            left: 25%;
            pointer-events: none;
        }
        #canvas {
            display: none;
        }
    </style>
</head>
<body>
    <h1>Webcam Serial Number Scanner</h1>
    <video id="video" autoplay></video>
    <div id="roi"></div>
    <button id="captureButton">Capture and Scan</button>
    <p id="result">Extracted Serial Number: <span id="extractedText"></span></p>

    <script>
        // Access webcam and display feed
        const video = document.getElementById('video');
        const canvas = document.createElement('canvas');
        const captureButton = document.getElementById('captureButton');
        const extractedTextElement = document.getElementById('extractedText');

        // Start the video stream
        navigator.mediaDevices.getUserMedia({ video: true })
            .then((stream) => {
                video.srcObject = stream;
            })
            .catch((err) => {
                console.error('Error accessing webcam:', err);
            });

        // Capture the image and run OCR
        captureButton.addEventListener('click', () => {
            // Set canvas dimensions to match the video
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext('2d');

            // Draw the current video frame onto the canvas
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

            // Define the region of interest (ROI)
            const roiWidth = canvas.width * 0.5;
            const roiHeight = canvas.height * 0.2;
            const roiX = canvas.width * 0.25;
            const roiY = canvas.height * 0.4;

            // Get the ROI from the canvas
            const roi = ctx.getImageData(roiX, roiY, roiWidth, roiHeight);

            // Create a temporary canvas for the ROI
            const roiCanvas = document.createElement('canvas');
            roiCanvas.width = roiWidth;
            roiCanvas.height = roiHeight;
            const roiCtx = roiCanvas.getContext('2d');
            roiCtx.putImageData(roi, 0, 0);

            // Use Tesseract.js to extract text from the ROI
            tesseract.recognize(roiCanvas, 'eng', {
                logger: (m) => console.log(m),
            }).then(({ data: { text } }) => {
                const cleanedText = text.replace(/[^A-Za-z0-9\-\s]/g, '').trim();
                extractedTextElement.textContent = cleanedText || 'No text detected';
                console.log('Extracted Text:', cleanedText);
            }).catch((err) => {
                console.error('Error during OCR:', err);
            });
        });
    </script>
</body>
</html>
